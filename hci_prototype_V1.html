<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="burgerMenu.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">

</head>
<body>
    <div id="burger-menu-container"></div>
    <div class="flexbox screen"> 
        <div class="section"> 
            <div class="block questions">
                <div>
                <h1>Fragen</h1>

                <div class="question-card">
                    <p class="question-meta">Ein Student fragt:</p>
                    <p class="question-text">Was sind Metaphern?</p>
                    <div class="question-actions">
                        <button class="upvote" data-votes="3">⬆ <span>3</span></button>
                        <button class="downvote">⬇</button>
                    </div>

                </div>

                <div class="question-card">
                    <p class="question-meta">Ein Student fragt:</p>
                    <p class="question-text">Was sind Metaphern?</p>
                    <div class="question-actions">
                        <button class="upvote" data-votes="3">⬆ <span>3</span></button>
                        <button class="downvote">⬇</button>
                    </div>
                </div>

                <div class="question-card">
                    <p class="question-meta">Ein Student fragt:</p>
                    <p class="question-text">Was sind Metaphern?</p>
                    <div class="question-actions">
                        <button class="upvote" data-votes="3">⬆ <span>3</span></button>
                        <button class="downvote">⬇</button>
                    </div>
                </div>
                </div>

                <div>
                    <input type="text" class="input-question" placeholder="Stelle eine Frage..."> 
                    <button class= "input-submit"> 
                        Frage abschicken
                    </button>

                </div>


        
        </div>
        </div>
        <div class="section"> 
            <div class="block"> 
                <iframe src="bewertungtool.html" style="width:100%;height:100%;border:0;" title="Bewertungstool"></iframe>
            </div>
            <div class="block"> </div>
        </div>
        <div class="section sidebar"> 
            <div class="flexbox verticalFlex">
                <div class="block qrCode">
                    <div style="display:flex;flex-direction:column;align-items:center;justify-content:flex-start;height:auto;font-size:16px;color:#333;padding-top:10px;">
                            <div style="margin-bottom:8px;">Scan mich zum Beitreten</div>
                    <img src="QR.png" alt="AR" id="arImage" style="max-width:100%;height:auto;display:block;margin:0 auto;" />
                    </div>
                </div>
                <div>
                    <div class="members">
                        <div class="participant">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                <path d="M12 12c2.761 0 5-2.239 5-5s-2.239-5-5-5-5 2.239-5 5 2.239 5 5 5z" fill="#444"/>
                                <path d="M4 20c0-2.761 4-4 8-4s8 1.239 8 4v1H4v-1z" fill="#444"/>
                            </svg>
                            <span id="participantCount">1</span>
                        </div>
                    </div>
                        
                    </div>
                    <div class="button button--fill"> 
                        <button id="openBewertungBtn" class="btn">Bewertung erstellen</button>
                    </div>

                    <div class="button"> </div>
                </div>
            </div>
        </div>
    </div>

    
        <script>
        // Burger-Menü laden
        fetch('burgerMenu.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('burger-menu-container').innerHTML = html;
            });


        //Öffnen des Bewertungspopups
        (function () {
            function openInIframe() {
                try {
                    var w = 720, h = 560;
                    var dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : screen.left;
                    var dualScreenTop = window.screenTop !== undefined ? window.screenTop : screen.top;
                    var width = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width;
                    var height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height;
                    var left = ((width / 2) - (w / 2)) + dualScreenLeft;
                    var top = ((height / 2) - (h / 2)) + dualScreenTop;
                    var features = 'scrollbars=yes,resizable=yes,toolbar=no,location=no,status=no,menubar=no,width=' + w + ',height=' + h + ',top=' + top + ',left=' + left;
                    var popup = window.open('bewertung_popup.html', 'bewertungPopup', features);
                    if (popup && popup.focus) popup.focus();
                    if (!popup) {
                        try { window.open('bewertung_popup.html', '_blank'); } catch (e) { window.location.href = 'bewertung_popup.html'; }
                    }
                } catch (err) {
                    console.warn('Konnte Popup-Fenster nicht öffnen, navigiere zur Popup-Seite:', err);
                    try { window.open('bewertung_popup.html', '_blank'); } catch (e) { window.location.href = 'bewertung_popup.html'; }
                }
            }

            var btn = document.getElementById('openBewertungBtn');
            if (btn) btn.addEventListener('click', function (e) {
                e.preventDefault();
                openInIframe();
            });
        })();

        window.addEventListener('message', function (ev) {
            try {
                var data = ev.data || {};
                if (data && data.type === 'pollSaved') {
                    var iframe = document.querySelector('iframe[title="Bewertungstool"]');
                    if (iframe && iframe.contentWindow) {
                        try { iframe.contentWindow.postMessage({ type: 'reloadPolls' }, '*'); } catch (e) {}
                    }
                }
            } catch (err) { console.warn('Fehler forwarding pollSaved:', err); }
        });

        function setParticipantCount(n) {
            var el = document.getElementById('participantCount');
            if (el) el.textContent = String(n);
        }
        window.setParticipantCount = setParticipantCount;
        </script>
</body>
</html>

<script>
document.addEventListener("click", function (e) {

    // UPVOTE
    if (e.target.closest(".upvote")) {
        const btn = e.target.closest(".upvote");
        let votes = parseInt(btn.dataset.votes, 10);

        votes++;
        btn.dataset.votes = votes;
        btn.querySelector("span").textContent = votes;
    }

    // DOWNVOTE
    if (e.target.closest(".downvote")) {
        const downBtn = e.target.closest(".downvote");
        const upBtn = downBtn.parentElement.querySelector(".upvote");

        let votes = parseInt(upBtn.dataset.votes, 10);

            votes--;
            upBtn.dataset.votes = votes;
            upBtn.querySelector("span").textContent = votes;
    }

});
</script>
